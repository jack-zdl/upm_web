<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>site-add</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link href="" rel="stylesheet">
<script src="js/plugin/my/jquery.serialize-object.min.js" type="text/javascript" ></script>
<style type="text/css">
.add-site-form { padding-top: 5px; margin: 0 auto; width: 100%;}
.add-site-form table { font-family: "微软雅黑", Arial, Helvetica, sans-serif; color: #666666; font-size: 14px; font-weight: bold; width: 100%;}
.add-site-form table tr { border: 15px solid #ffffff; }
.add-site-form table td { width:150px; text-align:right}
.start-color-red{
	color:red;
}
/* 通用 */
::-webkit-input-placeholder {  font-size:100% ;font-weight:200}
::-moz-placeholder {  font-size:100% ;font-weight:200} /* firefox 19+ */
:-ms-input-placeholder { font-size:100% ;font-weight:200} /* ie */
input:-moz-placeholder { font-size:100% ;font-weight:200}

</style>
</head>
<body>
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">主机注册</h4>
      </div>
      <div class="modal-body">
          <div class="add-site-form" >
            <form  id="machine_form">
         
                    <table>
                      <tr>
                      <td >主机名&nbsp;&nbsp;&nbsp;&nbsp;<sup class="start-color-red">*</sup></td>
                      <td> <input name="name" type="text" placeholder="请输入主机名" /> </td>
                      <td>主机IP&nbsp;&nbsp;&nbsp;&nbsp;<sup class="start-color-red">*</sup></td>
                      <td> <input name="sshIp" type="text" placeholder="请输入主机IP" /> </td>
                      </tr>
                      <tr>
                      <td>所属区域&nbsp;&nbsp;&nbsp;&nbsp;<sup class="start-color-red">*</sup></td>
                      <td ><select class="selectpicker form-control"  multiple data-max-options="1" id="areaId" name="areaId" title="请选择区域" style="150px" >
                                        
                          </select></td>
                      
                      <td>所属集群&nbsp;&nbsp;&nbsp;&nbsp;<sup class="start-color-red">*</sup></td>
                      <td> <select class="selectpicker form-control" multiple data-max-options="1"  id="clusterId" name="clusterId" title="请选择集群">
                          </select> 
                      </td>
                      </tr>
                       <tr>
                      <td>容器上限&nbsp;&nbsp;&nbsp;&nbsp;<sup class="start-color-red">*</sup></td>
                      <td> <input name="maxContainer" type="text" placeholder="请输入容器上限" />
                          
					  </td>
                      </tr>
                      <tr>
                      <td>SSH用户名&nbsp;&nbsp;&nbsp;<sup class="start-color-red">*</sup></td>
                      <td><input name="sshUser" type="text" placeholder="请输入SSH用户名" /></td>
                      <td>SSH密码&nbsp;&nbsp;&nbsp;&nbsp;<sup class="start-color-red">*</sup></td>
                      <td><input name="sshPassword" type="password" placeholder="请输入SSH密码"/></td>
                      </tr>
                        <tr>
                      <td>机房&nbsp;&nbsp;&nbsp;&nbsp;<sup class="start-color-red">*</sup></td>
                      <td><input name="room" type="text" placeholder="请输入机房标识" /></td>
                      <td>机位&nbsp;&nbsp;&nbsp;&nbsp;<sup class="start-color-red">*</sup></td>
                      <td><input name="seat" type="text" placeholder="请输入机位标识"/></td>
                      </tr>
                       <tr>
                      <td>HDD设备&nbsp;&nbsp;&nbsp;&nbsp;<sup class="start-color-red">*</sup></td>
                      <td><input name="hddDev" type="text" placeholder="请输入HHD设备标识" /></td>
                      <td>SSD设备&nbsp;&nbsp;&nbsp;&nbsp;<sup class="start-color-red">*</sup></td>
                      <td><input name="ssdDev" type="text" placeholder="请输入SSD设备标识"/></td>
                      </tr>
                       <tr>
                       <!-- 
                      <td>外部存储&nbsp;&nbsp;&nbsp;&nbsp;</td>
                      <td><select class="form-control" id="sanId" name="sanId">
                            <option  value="">请选择</option>              
                          </select> </td>
                           -->
                      <td>网卡类型&nbsp;&nbsp;&nbsp;&nbsp;<sup class="start-color-red">*</sup></td>
                      <td><select class=" selectpicker form-control" multiple data-max-options="1" id="nicPhyType" name="nicPhyType" title="请选择网卡">
                                       
                          </select></td>
                      </tr>
                    </table>
            </form>
                </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" id="ajax-btn" class="btn btn-primary">确认</button>
      </div>
      <script src="host.js"></script>
      <script>
      $('#areaId').selectpicker({
	        'selectedText': 'cat'
	    });
      $('#clusterId').selectpicker({
	        'selectedText': 'cat'
	    });
	   $('#nicPhyType').selectpicker({
	        'selectedText': 'cat'
	    });
      $(function(){ 
    	  selectarea();
    	  selectnicPhyType();
 	 });
		  function selectarea(){
			//  alert("host"+host);
			  $.ajax({
	              	url:host+"/upm_api/v1.0/selections/areas?siteId="+siteId,
		                method: "get",
		                async: true,
		                dataType: "json",
		                timeout:30000,
		                beforeSend:function(){
		                	$('#loading').showLoading();
		                },
		                success: function(result, status, xhr) {
		                	var json;
		                	console.log(json);
		                	for(i in result){	                		
		                		json=result[i];
		                		var html="<option value='"+json.id+"'>"+json.text+"</option>"
		                		$("#areaId").append(html);
		                	}
		                	 $('.selectpicker').selectpicker('refresh');
		                	
		                },
		                error: function(XMLHttpRequest, status, jqXHR, textStatus, e) {
		                	alert("未连接服务器");
		                    console.error("未连接服务器 =" + status);
		                },
		                complete:function(){
		                	$('#loading').hideLoading();
		                }
	          	});
      }
		  function selectnicPhyType(){
			  $.ajax({
	              	url:host+"/upm_api/v1.0/selections/nic-phy-types",
		                method: "get",
		                async: true,
		                dataType: "json",
		                timeout:30000,
		                beforeSend:function(){
		                	$('#loading').showLoading();
		                },
		                success: function(result, status, xhr) {
		                	var json;
		                	console.log(json);
		                	for(i in result){	                		
		                		json=result[i];
		                		var html="<option value='"+json.id+"'>"+json.text+"</option>"
		                		$("#nicPhyType").append(html);
		                	}
		                	 $('.selectpicker').selectpicker('refresh');
		                	
		                },
		                error: function(XMLHttpRequest, status, jqXHR, textStatus, e) {
		                	alert("未连接服务器");
		                    console.error("未连接服务器 =" + status);
		                },
		                complete:function(){
		                	$('#loading').hideLoading();
		                }
	          	});
      }
		  function selectsanId(){
			  $.ajax({
	              	url:host+"/upm_api/v1.0/selections/storage-types",
		                method: "get",
		                async: true,
		                dataType: "json",
		                timeout:30000,
		                beforeSend:function(){
		                	$('#loading').showLoading();
		                },
		                success: function(result, status, xhr) {
		                	var json;
		                	console.log(json);
		                	for(i in result){	                		
		                		json=result[i];
		                		var html="<option value='"+json.id+"'>"+json.text+"</option>"
		                		$("#sanId").append(html);
		                	}
		                	
		                },
		                error: function(XMLHttpRequest, status, jqXHR, textStatus, e) {
		                	alert("未连接服务器");
		                    console.error("未连接服务器 =" + status);
		                },
		                complete:function(){
		                	$('#loading').hideLoading();
		                }
	          	});
      }
		  $("#areaId").change(function(){
			  
	             var areaId = $(this).children('option:selected').val(); 
	             $.ajax({
	                      url:host+ "/upm_api/v1.0/selections/clusters?areaId="+areaId,
	                      method: "get",
	                      async: false,
	                      contentType: "application/json; charset=utf-8",
	                      dataType: "json",
	                      timeout:30000,
	  	                beforeSend:function(){
	  	                	$('#loading').showLoading();
	  	                },
	                      success: function(result, status, xhr) {
	                    	  
	                         changeAreaData(result);
	                      },
	                      error: function(XMLHttpRequest, status, jqXHR, textStatus, e) {
	                        alert("未连接服务器");
	                        console.error("未连接服务器 =" + status);
	                      },
	                      complete:function(){
	  	                	$('#loading').hideLoading();
	  	                }
	                  });
	          //   alert($(this).children('option:selected').val()); 
	              function changeAreaData(obj_data){
	            	  $("#clusterId").empty();
	                for (var i = obj_data.length - 1; i >= 0; i--) {
	                      $("#clusterId").append("<option  value="+obj_data[i].id+">"+obj_data[i].text+"</option>");
	                }
	                $('.selectpicker').selectpicker('refresh');
	              }
	           });
		  
      </script>
      <script type="text/javascript">
      $("#ajax-btn").click(function (){
      	  var params = $("#machine_form").serializeObject();
      	params.maxContainer = Number(params.maxContainer);
      	if(params.ssdDev==""){
      		params.ssdDev=null;
      	}if(params.sanId==""){
      	
      		params.sanId=null;
      	}
      	  debugger;
      	  console.log(params);
      	  
      	  if(params.sanId==""){
      		params.sanId = null;
      	  }
      	  console.log(params);
      	  $.ajax({
                url:host+"/upm_api/v1.0/hosts",
                method: "post",
                async: true,
                contentType: "application/json; charset=utf-8",
                data:JSON.stringify(params),
                dataType: "json",
                timeout:30000,
                beforeSend:function(){
                	$('#loading').showLoading();
                },
                success: function(result, status, xhr) {
                  	
                   changenfsData(result);
                },
                error: function(XMLHttpRequest, status, jqXHR, textStatus, e) {
                  alert("未连接服务器");
                  console.error("未连接服务器 =" + status);
                },
                complete:function(){
                	$('#loading').hideLoading();
                }
            });
        })
        function changenfsData(obj_data){
    	  if(obj_data.result!=""){
            switch (obj_data.result){
              case 1:
            	  alert("成功信息:"+obj_data.msg);
                $('#myModal').modal('hide');
                break;
              case 0:
            	  alert("警告信息:"+obj_data.msg);
                break;
              case -1:
            	  alert("错误信息:"+obj_data.msg);
                break;
              case -9:
                alert("信息:"+obj_data.msg);
                window.location="login.html";
              default:
            	  alert("测试代码");
            }
    	  }
        }
      </script>
</body>
</html>